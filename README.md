# Railway Map Editor (GeoJSON Builder)

日本の鉄道路線を描画・編集できるWebアプリケーションです。

## 主な機能

### 1. 路線描画機能
- 地図上をクリックして新しい路線を作成
- 路線名、運営会社、事業者区分、路線種類を設定
- カスタムカラーで路線を表示

### 2. 座標編集機能
- 既存の路線を選択
- 個別の座標を編集または削除
- MultiLineStringの場合、個別ラインの選択と削除が可能
- 路線情報（路線名、運営会社など）の編集
- 路線全体の削除
- リアルタイムで地図に反映

### 3. ファイル入出力
複数の地理空間データ形式をサポート:
- **GeoJSON (.json)**: 標準的なGeoJSON形式
- **WKT JSON (.json)**: JSON内にWKT文字列を含む形式
- **WKT テキスト (.wkt, .txt)**: 純粋なWKT文字列のテキストファイル
- **CSV (.csv)**: WKT列を含むCSVファイル
- 読み込み時にファイル拡張子から形式を自動判別

## 使い方

### 新しい路線を描画する
1. 路線情報（路線名、運営会社など）を入力
2. 「📍 描画開始」をクリック
3. 地図上をクリックして座標を追加
4. 「✓ 路線完成」で完了

### 既存の路線を編集する
1. 「✏️ 座標編集モード」をクリック
2. 地図上の路線をクリックして選択
3. 左側のパネルで以下の操作が可能:
   - **路線情報編集**: 路線名、運営会社などを変更
   - **路線全体削除**: 路線を完全に削除
   - **ライン選択**: MultiLineStringの場合、個別ラインを選択
   - **ライン削除**: 選択したラインを削除
   - **座標編集**: 個別座標の経度・緯度を変更
   - **座標削除**: 個別座標を削除

### ファイルを保存する
1. 保存形式を選択:
   - GeoJSON (.json)
   - WKT JSON (.json)
   - WKT テキスト (.wkt)
   - CSV (.csv)
2. 「💾 ファイル保存」をクリック

### ファイルを読み込む
1. 「📂 ファイル読込」をクリック
2. ファイルを選択（.json, .wkt, .txt, .csv）
3. 形式は自動認識されます

## データ形式

### 1. GeoJSON形式（内部形式）
```json
[
  {
    "label": "山手線",
    "N02_004": "東日本旅客鉄道",
    "N02_002": "2",
    "N02_001": "11",
    "coordinates": [[139.7, 35.7], [139.71, 35.71]]
  }
]
```

### 2. WKT JSON形式
```json
[
  {
    "label": "山手線",
    "N02_004": "東日本旅客鉄道",
    "N02_002": "2",
    "N02_001": "11",
    "geometry": "LINESTRING(139.7 35.7, 139.71 35.71)"
  }
]
```

### 3. WKT テキスト形式 (.wkt)
```
# 山手線 (東日本旅客鉄道)
LINESTRING(139.7 35.7, 139.71 35.71, 139.72 35.72)

# 中央線 (東日本旅客鉄道)
MULTILINESTRING((139.6 35.6, 139.61 35.61), (139.62 35.62, 139.63 35.63))
```

### 4. CSV形式
```csv
label,operator,operatorType,railwayType,geometry
山手線,東日本旅客鉄道,2,11,"LINESTRING(139.7 35.7, 139.71 35.71)"
中央線,東日本旅客鉄道,2,11,"MULTILINESTRING((139.6 35.6, 139.61 35.61), (139.62 35.62, 139.63 35.63))"
```

### フィールド説明
- **label**: 路線名
- **N02_004 / operator**: 運営会社名
- **N02_002 / operatorType**: 事業者区分コード (1: JR新幹線, 2: JR在来線, 3: 公営鉄道, 4: 民営鉄道, 5: 第三セクター)
- **N02_001 / railwayType**: 路線種類コード (11: JR, 12: 普通鉄道, 21: 軌道, 22: 懸垂式モノレール, 23: 跨座式モノレール)
- **coordinates / geometry**: 座標データ (GeoJSON配列またはWKT文字列)

## 技術スタック
- Mapbox GL JS
- Vanilla JavaScript
- HTML5/CSS3

## ライセンス
MIT
